import{a as L}from"./index-B9ygI19o.js";import{f as C,g as k,h as M,c as O,b as y,a as l,w as a,r as s,t as U,F as S,E as c,o as F,d as i,n as J}from"./index-DRXSRtcv.js";L.defaults.baseURL="";const x=[1,2,3,4,5].map(d=>({id:d,date:`2016-05-0${d}`,name:"王小虎",pwd:"123456"})),T=d=>Promise.resolve({data:{code:0,data:{records:x,total:x.length}}}),q=d=>Promise.resolve({data:{code:0,msg:"ok"}}),z=d=>Promise.resolve({data:{code:0,msg:"ok"}}),I=d=>Promise.resolve({data:{code:0,msg:"ok"}}),R={style:{background:"#eef",padding:"10px","margin-bottom":"10px","border-radius":"4px"}},G={__name:"User",setup(d){const u=C({name:"",page:1,size:10}),g=k([]),f=k(0),m=k(!1),t=C({id:0,name:"",pwd:""}),p=async()=>{console.log("=== 开始获取用户列表 ===");try{const o=await T(u);console.log("用户接口返回:",o),g.value=o.data.data.records||[],f.value=o.data.data.total||0,console.log("设置后的用户list:",g.value),console.log("设置后的用户total:",f.value)}catch(o){console.error("获取用户列表失败:",o),c.error("获取用户列表失败")}},V=o=>{console.log("打开用户弹窗，行数据:",o),o?(t.id=o.id,t.name=o.name||"",t.pwd=o.pwd||""):(t.id=0,t.name="",t.pwd=""),m.value=!0},P=async()=>{console.log("=== 开始保存用户 ==="),console.log("用户表单数据:",JSON.parse(JSON.stringify(t)));try{let o;t.id?(o=await z(t),console.log("用户更新结果:",o)):(o=await q(t),console.log("用户添加结果:",o)),c.success("保存成功"),m.value=!1,console.log("用户保存成功，重新获取列表..."),await p(),await J(),console.log("用户DOM更新完成")}catch(o){console.error("用户保存失败:",o),c.error(o?.message||o?.msg||"保存失败")}},N=async o=>{console.log("=== 开始删除用户 ==="),console.log("要删除的用户行数据:",o),console.log("要删除的用户ID:",o.id,"类型:",typeof o.id);try{console.log("调用用户删除接口...");const e=await I(o.id);console.log("用户删除接口返回结果:",e),c.success("删除成功"),console.log("用户删除成功，重新获取列表..."),await p(),console.log("用户列表重新获取完成")}catch(e){console.error("用户删除失败:",e),c.error(e?.msg||"删除失败")}};return M(()=>{console.log("=== 用户组件挂载 ==="),p()}),(o,e)=>{const b=s("el-input"),v=s("el-form-item"),r=s("el-button"),w=s("el-form"),_=s("el-table-column"),$=s("el-table"),B=s("el-pagination"),D=s("el-dialog");return F(),O(S,null,[y("div",null,[l(w,{inline:""},{default:a(()=>[l(v,{label:"用户名"},{default:a(()=>[l(b,{modelValue:u.name,"onUpdate:modelValue":e[0]||(e[0]=n=>u.name=n),placeholder:"请输入"},null,8,["modelValue"])]),_:1}),l(v,null,{default:a(()=>[l(r,{type:"primary",onClick:p},{default:a(()=>[...e[7]||(e[7]=[i("查询",-1)])]),_:1}),l(r,{onClick:e[1]||(e[1]=n=>V())},{default:a(()=>[...e[8]||(e[8]=[i("添加",-1)])]),_:1})]),_:1})]),_:1}),y("div",R,[y("div",null,"列表长度: "+U(g.value.length)+", 总数: "+U(f.value),1)]),l($,{data:g.value,border:""},{default:a(()=>[l(_,{prop:"date",label:"日期",width:"120"}),l(_,{prop:"name",label:"用户名"}),l(_,{prop:"pwd",label:"密码"}),l(_,{label:"操作",width:"180"},{default:a(({row:n})=>[l(r,{link:"",onClick:E=>V(n)},{default:a(()=>[...e[9]||(e[9]=[i("编辑",-1)])]),_:1},8,["onClick"]),l(r,{link:"",type:"danger",onClick:E=>N(n)},{default:a(()=>[...e[10]||(e[10]=[i("删除",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"]),l(B,{class:"mt-4",background:"",layout:"prev, pager, next",total:f.value,"current-page":u.page,"onUpdate:currentPage":e[2]||(e[2]=n=>u.page=n),onCurrentChange:p},null,8,["total","current-page"])]),l(D,{modelValue:m.value,"onUpdate:modelValue":e[6]||(e[6]=n=>m.value=n),title:t.id?"编辑":"添加",width:"400"},{footer:a(()=>[l(r,{onClick:e[5]||(e[5]=n=>m.value=!1)},{default:a(()=>[...e[11]||(e[11]=[i("取消",-1)])]),_:1}),l(r,{type:"primary",onClick:P},{default:a(()=>[...e[12]||(e[12]=[i("确定",-1)])]),_:1})]),default:a(()=>[l(w,{model:t,"label-width":"60"},{default:a(()=>[l(v,{label:"用户名"},{default:a(()=>[l(b,{modelValue:t.name,"onUpdate:modelValue":e[3]||(e[3]=n=>t.name=n)},null,8,["modelValue"])]),_:1}),l(v,{label:"密码"},{default:a(()=>[l(b,{modelValue:t.pwd,"onUpdate:modelValue":e[4]||(e[4]=n=>t.pwd=n)},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])],64)}}};export{G as default};
